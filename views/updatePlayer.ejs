<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Detail page</title>

   
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Sharp" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

</head>
<body>
    <!-- navbar -->
    <nav>
        <div class="container">
            <a href="/"><img src="./images/fsrs.png" class="logo" alt="logo"></a>
            <div class="search-bar">
                <span class="material-icons-sharp">search</span>
                <input type="search" placeholder="Search">
            </div>
            <% if (user) { %>
            <div class="profile-area">
                <button id="menu-btn">
                    <span class="material-icons-sharp">menu</span>
                </button>
            </div>
            <%} else { %>
                <a href="/login" class="">
                    <span class="material-symbols-outlined">
                        login
                    </span>
                </a>
            <%} %>
        </div>
    </nav>

    <!-- main -->

    <main>

        <!-- aside -->
        <aside>
            <button id="close-btn">
                <span class="material-icons-sharp">close</span>
            </button>
            <div class="sidebar">
                <% if (user) { %>
                    <div class="profile-area">
                        <div class="profile-photo">
                            <img src="<%= user.profileImage %>" alt="<%= user.fullName %> Profile Picture">
                        </div>
                        <div class="profileName">
                            <h3> <%= user.fullName %> </h3>
                        </div>
                        <a href="#">
                            <span class="material-icons-sharp">settings</span>
                            <h4>Edit</h4>
                        </a>
                    </div>
                    <%} else { %>
                        <a href="/login" class="">
                            <span class="material-symbols-outlined">
                                login
                            </span>
                        </a>
                    <%} %>
                <a href="#" class="active">
                    <span class="material-icons-sharp">dashboard</span>
                    <h4>Dashboard</h4>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">currency_exchange</span>
                    <h4>Market</h4>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">pie_chart</span>
                    <h4>Analytics</h4>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">help_center</span>
                    <h4>Help Center</h4>
                </a>
                <a href="#">
                    <span class="material-icons-sharp">settings</span>
                    <h4>Settings</h4>
                </a>
                <a href="#" onclick="openPopup()">
                    <span class="material-icons-sharp">logout</span>
                    <h4>Logout</h4>
                </a>
            </div>
            <div id="popup" class="popup">
                <div class="popup-content">
                    <span class="close" onclick="closePopup()">&times;</span>
                    <h1>Are you sure you want to log out?</h1>
                    <a href="/logout"><button class="yes" onclick="logout()">Yes</button></a>
                    <button class="no" onclick="closePopup()">No</button>
                </div>
            </div>
        </aside>

        <!--Middle Section-->
        <section class="middle">
            <main class="table" id="customers_table">
            
                <section class="table__body">
                    <form method="post" id="detailUpdate" action="/updatePlayerDetail/<%= player._id %>">
                        <h3>update player detail</h3>
                        
                        <span>playerName</span>
                        <input type="text" name="playerName" class="box" value="<%= player.playerName %>" id="playerName" required>
                        <div class="playerName error"></div>
                        
                        <span>dob</span>
                        <input type="text" name="dob" class="box" value="<%= player.dob %>" id="dob" required>
                        <div class="dob error"></div>
                        
                        <span>details</span>
                        <div>
                            <select class="box" id="team" name="team">
                                <% team.forEach(team => { %>
                                    <option value="<%= team._id %>" name="<%= team._id %>" <%= player.team && player.team._id.toString() === team._id.toString() ? 'selected' : '' %>><%= team.name %></option>
                                <% }); %>
                            </select>
                            <div class="team error"></div>
                        </div>
                        
                        <span>position</span>
                        <input type="position" name="position" class="box" value="<%= player.position %>" id="position" required>
                        <div class="position error"></div>
                      
                        <span>transferPrice</span>
                        <input type="transferPrice" name="transferPrice" class="box" value="<%= player.transferPrice %>" id="transferPrice" required>
                        <div class="transferPrice error"></div>
                      
                      </form>
                      
                      <script>
                        window.addEventListener('DOMContentLoaded', (event) => {
                            const detailUpdate = document.querySelector('#detailUpdate');
                            const imageUpdate = document.querySelector('#imgUpdate');
                            // read the error
                            const playerNameError = document.querySelector('.playerName.error');
                            const positionError = document.querySelector('.position.error');
                            const dobError = document.querySelector('.dob.error');
                            const transferPriceError = document.querySelector('.transferPrice.error');
                            const teamError = document.querySelector('.team.error');
                            const playerImageError = document.querySelector('.playerImage.error');
                        
                            detailUpdate.addEventListener('submit', async (e) => {
                              e.preventDefault();
                              // reset errors
                              playerNameError.textContent = '';
                              positionError.textContent = '';
                              dobError.textContent = '';
                              transferPriceError.textContent = '';
                              teamError.textContent = '';
                      
                              // Create a JSON object
                              const formData = {
                                  'playerName': detailUpdate.playerName.value,
                                  'position': detailUpdate.position.value,
                                  'dob': detailUpdate.dob.value,
                                  'team': detailUpdate.team.value,
                                  'transferPrice': detailUpdate.transferPrice.value,
                              };
                              console.log(formData);
                      
                              try{
                                  const id = '<%= player._id %>'
                                  const res = await fetch(`/updatePlayerDetail/${id}`, {
                                      method: 'POST',
                                      headers: {
                                          'Content-Type': 'application/json'
                                      },
                                      body: JSON.stringify(formData), // Send the JSON data
                                  });
                                  const data = await res.json();
                                  console.log(data);
                      
                                  if (data.errors){
                                      ISBNError.textContent = ('This name is already registered');
                                  }
                                  else{
                                      descriptionError.textContent = ('Added successfully');
                                  }
                              }
                              catch (err){
                                  console.log(err);
                              }
                          });
                        });
                      </script>

